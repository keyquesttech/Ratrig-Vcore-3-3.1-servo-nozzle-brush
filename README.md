
<div align="center">
  <strong><h1>Ratrig servo nozzle brush</h1></strong>

![GitHub forks](https://img.shields.io/github/forks/keyquesttech/Ratrig-Vcore-3-3.1-servo-nozzle-brush)
![GitHub Repo stars](https://img.shields.io/github/stars/keyquesttech/Ratrig-Vcore-3-3.1-servo-nozzle-brush)
![GitHub last commit](https://img.shields.io/github/last-commit/keyquesttech/Ratrig-Vcore-3-3.1-servo-nozzle-brush)
 
</div>

<div align="center">
  With the introduction of beacon touch/contact, having a clean nozzle is essential, especially if you plan to use more than three samples. Therefore, a solution to clean the nozzle was needed. However, the Vcore-3/3.1 is tight on space, and the nozzle does not hang over the edge of the bed in any position. As a result, having a servo-mounted brush was necessary. That is why I designed this solution.
  <br><br>
  <img src="https://raw.githubusercontent.com/keyquesttech/Ratrig-Vcore-3-3.1-servo-nozzle-brush/main/imgs/1.png" alt="Servo Nozzle Brush" style="margin-top: 10px;">
  <br><br>

  <hr>
  
  For STL files, visit this link. Downloading from there helps support my work: <a href="https://www.printables.com/model/913748-ratrig-vcore-331-servo-nozzle-brush">https://www.printables.com/model/913748-ratrig-vcore-331-servo-nozzle-brush</a>
  <br><br>
</div>

<hr>

<div align="center">
  <strong><h1>Instructions:</h1></strong>
</div>

**Disclaimers:** 
 - The parts were designed to be printed via SLS; however, all parts can be printed via FDM on a standard 3D printer such as a RatRig. Please note that support will be necessary.
 - A 270 degree servo is needed if you plan to mount the servo on the right.
 - The spacer and screw length needs to be customized for your setup.
 
Click the image with your servo configuration and it will take you to the right STL file.

| Left mount servo | Right mount servo |
|--|--|
| <a href="https://www.printables.com/model/913748-ratrig-vcore-331-servo-nozzle-brush/files#preview:file-6haNp"><img src="https://raw.githubusercontent.com/keyquesttech/Ratrig-Vcore-3-3.1-servo-nozzle-brush/main/imgs/6.png" alt="Servo Nozzle Brush" style="margin-top: 10px;"></a> | <a href="https://www.printables.com/model/913748-ratrig-vcore-331-servo-nozzle-brush/files#preview:file-Ac7of"><img src="https://raw.githubusercontent.com/keyquesttech/Ratrig-Vcore-3-3.1-servo-nozzle-brush/main/imgs/4.png" alt="Servo Nozzle Brush" style="margin-top: 10px;"></a> |

<div align="center">
  Customize the height of the spacer as needed so that the brush touches the nozzle:
  <br><br>
  <img src="https://raw.githubusercontent.com/keyquesttech/Ratrig-Vcore-3-3.1-servo-nozzle-brush/main/imgs/5.png" alt="Servo Nozzle Brush" style="margin-top: 10px;">
</div>

<hr>

**Parts needed:**

 - Printed parts:
	 - [20kg_servo_mount.stl](https://www.printables.com/model/913748-ratrig-vcore-331-servo-nozzle-brush/files#preview:file-N7Lmn) This is the part that holds the servo.
	 - [Brush_holder.stl](https://www.printables.com/model/913748-ratrig-vcore-331-servo-nozzle-brush/files#preview:file-tgc1A) This is the part that holds the brush
	 - [Spacer.stl](https://www.printables.com/model/913748-ratrig-vcore-331-servo-nozzle-brush/files#preview:file-KP0vf) The height of the spacer can/needs to be customized to modify the nozzle contact with the brush, this can be done in slicer (no cad skils needed).
	 - [Arm_Left_servo.stl](https://www.printables.com/model/913748-ratrig-vcore-331-servo-nozzle-brush/files#preview:file-Ac7of) The "left"/"right" in the name indicates where the arm mounts to the servo, so use this file if you plan to mount the servo to the right.
	 - [Arm_Right_servo.stl](https://www.printables.com/model/913748-ratrig-vcore-331-servo-nozzle-brush/files#preview:file-6haNp) The "left"/"right" in the name indicates where the arm mounts to the servo, so use this file if you plan to mount the servo to the left.

 - Electronics:
	 - 1x: [270 degree 20kg servo](https://www.amazon.com/dp/B076CNKQX4?psc=1&ref=ppx_yo2ov_dt_b_product_details)

 - Hardware:
	 - 1x: [Brass brush](https://www.amazon.com/dp/B0C786T8Z7?psc=1&ref=ppx_yo2ov_dt_b_product_details) This one is pre cut but you can use any other brass brush and cut it yourself, in fact that may be better since you can cut it to fit perfectly.

 - Fasteners:
	 - 2x: [Cap Head Screw M6x12](https://www.amazon.com/Cicidorai-M6-1-0-Socket-Machine-Quantity/dp/B09Y5JQNV8/ref=sr_1_3?crid=3QNVJMDBC6E7F&dib=eyJ2IjoiMSJ9.xDl6tqKGTTNDHsfl_PrKSv01_ZL0IbwG0vqe3h_ZjH9t5ZWy_y6ASDL9XNF1sS2n0eamh1TW0LT9sDMLD20Z2hTGfum5UQOprzu76JqjC2cN4QKdMj3QDDKKSY85dvr_u_f7m50pAbIrR8qMSziPJQ57dDroNBIHHKR1yqbj8tE8RXZ59PuYPOvlB6zFagFBrZNYwcUjPHC9PSFcWjFMCrk4q9vj4MQaB821cfC1gBI.jKD7vU-E7CGWHtQGhEy5cGS9fnWTqx-CVWn1NwPPtVE&dib_tag=se&keywords=Cap%20Head%20Screw%20M6x12&qid=1718594236&sprefix=cap%20head%20screw%20m6x12,aps,236&sr=8-3) Used to mount the servo to the frame. You may have some leftovers from the ones included in the RatRig kit.
	 - 2x: [3030 series M6 T nut](https://www.amazon.com/Fastener-European-Aluminum-Profile-Assortment/dp/B0CG4TNZRH/ref=sr_1_2_sspa?crid=3U0VLBKWJE20U&dib=eyJ2IjoiMSJ9.UfxRy4KC-e3dUK55ZeQ5yU8n3VOfLeAEaTuLTlfm6LavjkYpyK0FeIQ0NHy5Yv1ENRjDTqboRz7Sc5nKg2jc1SE9VW4gFYKbgFdoLUdy0Ysr2ImY0cEFKlbK1qi3lSRZpfz6aEmmyM8WXQTkiUPWG7lnOl9ADYsMeh3TwaIGf3srRHVjsMYGT7EsgEdTobLsg0Th745hN0zZP0ISt-LZvR2znpY8ImSyuaFtSoH8Ofw.dLMbik4Bh82fL5ZdBXI10wH4riYtD_CmOrRhZ4HxCY4&dib_tag=se&keywords=m6%2b3030%2bt%2bnut&qid=1718594332&sprefix=M6%2b3030%2b,aps,123&sr=8-2-spons&sp_csd=d2lkZ2V0TmFtZT1zcF9hdGY&th=1) Used to mount the servo to the frame. You may have some leftovers from the ones included in the RatRig kit.
	 - 4x: [M4 heatset insert](https://www.amazon.com/gp/product/B08YYGRCBG/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&th=1) The hole for the inserts is 5.3mm in diameter and 7.5mm in lenght. A 6mm long insert is recommended.
	 - 4x: [M4 screws](https://www.amazon.com/HELIFOUNER-Pieces-Socket-Washers-Threaded/dp/B0CDSKK7V1/ref=sr_1_3?crid=2FYQYG4WHJ68M&dib=eyJ2IjoiMSJ9.f8fJT3uyL2E0z-jqgxfW-X8nSnKZVs1Q-Qj5mQMIEeZKIMneVzFPxkFcMYCMyo0Ct6wODW07Fq4YI6v-ajKbUuA1xHEgBL_iyWWQNNxk76HQV1-fAEiqcTwbL8gTkcgkfuJKWvVNKew1lZayJuojM8n_DFPvqBIoyaUTwKDvIDlx9fslPcNMWAFKQYZeJrGGS-ywcNfN2hL7UUyCIGZa4DZLH6gVd-xfyMvzH8ODMJc.PY864v9Ymsx1RIigwQItJyjTnJATlA1qnCoPYk5Wf8Q&dib_tag=se&keywords=m4%2bscrew%2bkit%2b35mm/&qid=1718594658&sprefix=m4%2bscrew%2bkit%2b35mm,aps,152&sr=8-3&th=1) The lenght of these depends on the size of spacer you use, but between 25 and 35mm should be enough.
	 - 2x: [M3x6 screw](https://www.amazon.com/gp/product/B0CCMK6NQR/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&psc=1) Used to secure the brush arm to the servo.

<div align="center">
  <strong><h1>Macro</h1></strong>
</div>

**Disclaimers:** 
 - This specific macro loops the brushing moves, for that reason the "loop_macro" klipper extension needs to be installed: [Looping Macros by voidtrance](https://github.com/voidtrance/voron-klipper-extensions/tree/master/loop_macro)

Visit the [voron-klipper-extensions](https://github.com/voidtrance/voron-klipper-extensions) repo for details.

If you have installed the extension just include the "brush_macro.cfg" in to your files and call the macro via "_CLEAN_NOZZLE_WITH_BRUSH"

To customize the macro use the variables:

| Variable | Use |
|--|--|
| `variable_brush_hotend_temp` | Temperature the hotend will heat up to before starting brushing moves |
| `variable_brush_bed_location` | Absolute position of where to move the bed to deploy the servo brush |
| `variable_brush_bed_move_speed` | Bed travel moves speed in mm/s |
| `variable_brush_toolhead_move_speed` | Toolhead move speed in mm/s for brush routine |
| `variable_brush_speed` | Speed in mm/s for brush moves |
| `variable_brush_deploy_angle` | Angle of servo where the brush touches the nozzle |
| `variable_brush_stow_angle` | Angle of servo where the brush is out of the way |
| `variable_brush_toolhead_x_park_location` | Absolute position on x where the brushing starts |
| `variable_brush_toolhead_y_park_location` | Absolute position on y where the brushing starts |
| `variable_brush_move_for_front_to_back` | Distance to move in to the brush for side to side moves |
| `variable_brush_move_distance_side_to_side` | Distance of side moves on brush |
| `variable_brush_move_distance_front_to_back` | Distance of front / back moves |
| `variable_brush_circle_radius` | Diameter of brush circle |
| `Variable_brush_fan_speed` | 0 to 255 - part cooling fan speed to use while brushing, helps cool down faster |
| `Variable_retract_before_brushing` | True or false |
| `Variable_terminal_verbose` | True or false - if it should output to terminal what the macro/printer is doing |

This is what the macro does in order:

 1. Move bed out of the way.
 2. Heat hotend and wait for it to reach temp.
 3. Retract if defined.
 4. Park toolhead where the servo will deploy.
 5. Deploy serrvo.
 6. Wait for servo to deploy
 7. Set temp to whatever the preheat temp is set to according to the RatOS variable: preheat_extruder_temp.
 8. Turn on part cooling fan to speed up hotend cool down.
 9. Call  "_BRUSH_WIPE macro".
	 10.	Set position to relative
	 11.	Brush side to side.
	 12.	Brush front to back.
	 13.	Set position to absolute.
	 14.	Brush clockwise in a circle.
	 15.	Brush counter clockwise in a circle.
16.	Loop points 10 to 15 untill the hotend temperature is equal to preheat_extruder_temp.
17.	Onc ehotend temp is equal to preheat_extruder_temp break loop.
18.	Turn off fan.
19.	Stow servo.
20.	End macro.

To see how I have it implemented on my printer check this repo: 

 - My variable usage: [printer.cfg](https://github.com/keyquesttech/printer_backup/blob/main/printer_data/config/printer.cfg)
 - My macro: [defaultmacros.cfg](https://github.com/keyquesttech/printer_backup/blob/main/printer_data/config/User_files/printer/defaultmacros.cfg)

